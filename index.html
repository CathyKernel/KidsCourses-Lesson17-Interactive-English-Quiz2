<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOTW Lesson #A1-17: Prepositions & God's Laws</title>
    <style>
        :root {
            --primary: #4a6fa5;
            --secondary: #166088;
            --accent: #4fc3f7;
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;

            /* RGB versions for box-shadow focus rings */
            --rgb-primary: 74, 111, 165;
            --rgb-secondary: 22, 96, 136; 
            --rgb-success: 40, 167, 69;
            --rgb-danger: 220, 53, 69;
            --rgb-accent: 79, 195, 247;
            --rgb-btn-secondary-focus: 108, 117, 125; 
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background-color: #f5f7fa;
            margin: 0;
            padding: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 80vh;
            position: relative;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 8px 8px 0 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        h1, h2, h3 {
            margin: 0;
            font-weight: 600;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        h2 {
            color: var(--secondary);
            font-size: 1.8rem;
            margin: 25px 0 15px;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 8px;
        }
        
        h3 {
            font-size: 1.4rem;
            color: var(--primary);
            margin: 20px 0 10px;
        }
        
        .lesson-section {
            background-color: white;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: relative;
        }
        
        .edit-controls {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 5px; 
        }
        
        .edit-controls button {
            color: white;
            border: none;
            border-radius: 6px; 
            padding: 6px 12px; 
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s; 
            display: flex; 
            align-items: center;
            gap: 5px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
        }
        .edit-controls button i {
            font-size: 0.8rem; 
        }

        .edit-controls button:hover:not(:disabled) {
            transform: translateY(-1px); 
            box-shadow: 0 2px 5px rgba(0,0,0,0.15); 
        }
        .edit-controls button:active:not(:disabled) {
            transform: translateY(0px); 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
        }
         .edit-controls button:focus:not(:disabled) {
            outline: none; 
        }


        .edit-btn-section { background-color: var(--accent); }
        .edit-btn-section:hover:not(:disabled) { background-color: #29b6f6; } 
        .edit-btn-section:focus:not(:disabled) { box-shadow: 0 1px 3px rgba(0,0,0,0.1), 0 0 0 2.5px rgba(var(--rgb-accent), 0.5); } 


        .save-btn-section { background-color: var(--success); }
        .save-btn-section:hover:not(:disabled) { background-color: #218838; }
        .save-btn-section:focus:not(:disabled) { box-shadow: 0 1px 3px rgba(0,0,0,0.1), 0 0 0 2.5px rgba(var(--rgb-success), 0.5); } 

        .cancel-btn-section { background-color: var(--danger); }
        .cancel-btn-section:hover:not(:disabled) { background-color: #c82333; }
        .cancel-btn-section:focus:not(:disabled) { box-shadow: 0 1px 3px rgba(0,0,0,0.1), 0 0 0 2.5px rgba(var(--rgb-danger), 0.5); } 
        
        .edit-controls button:disabled {
            background-color: #ccc;
            color: #666; 
            cursor: not-allowed;
            transform: none; 
            box-shadow: none; 
        }

        .hidden {
            display: none !important;
        }
        
        .content-editable {
            min-height: 50px;
            padding: 10px;
            border: 1px dashed transparent;
            transition: all 0.3s;
            cursor: text; 
        }
        
        .content-editable:hover:not([contenteditable="true"]) {
            border-color: var(--accent);
            background-color: rgba(79, 195, 247, 0.05);
        }
        
        .content-editable[contenteditable="true"] {
            outline: none;
            border: 1px solid var(--accent);
            background-color: rgba(79, 195, 247, 0.1);
        }
        
        .image-container { 
            text-align: center;
            margin: 20px 0;
            position: relative;
        }
        
        .image-container img {
            max-width: 100%;
            height: auto;
            border-radius: 6px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }
        
        .image-container img:hover {
            transform: scale(1.02);
        }

        /* MODIFICATION: Added style for the specific image on page 2 */
        #bible-story-img {
            max-width: 600px; /* Limits the maximum width of the image */
            width: 100%;      /* Ensures it scales down within the container if container is narrower than 600px */
                               /* height: auto; will be inherited from .image-container img */
        }

        .image-gallery-container {
            display: flex;
            flex-wrap: wrap; 
            gap: 20px; 
            justify-content: space-around; 
            margin-bottom: 20px;
        }

        .image-gallery-container .image-upload-slot {
            flex: 1 1 300px; 
            max-width: 32%; 
            box-shadow: 0 1px 5px rgba(0,0,0,0.1); 
            padding: 15px; 
            border-radius: 8px; 
            background-color: #fff;
            text-align: center; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
        }

        .image-gallery-container .image-upload-slot img {
            max-width: 100%;
            height: auto; 
            min-height: 150px; 
            object-fit: cover; 
            border-radius: 6px; 
            margin-bottom: 15px; 
            background-color: #f0f0f0; 
        }
        
        .upload-btn {
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            gap: 8px; 
            margin-top: 10px;
            padding: 8px 15px;
            background-color: var(--primary);
            color: white;
            border: none; 
            border-radius: 6px; 
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500; 
            transition: all 0.2s ease-in-out; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
        }
        
        .upload-btn:hover:not(:disabled) {
            background-color: var(--secondary);
            transform: translateY(-1px); 
            box-shadow: 0 2px 5px rgba(0,0,0,0.15); 
        }
        .upload-btn:focus:not(:disabled) {
            outline: none; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1), 0 0 0 2.5px rgba(var(--rgb-primary), 0.5); 
        }
        .upload-btn:active:not(:disabled) {
            transform: translateY(0px); 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
        }
        .upload-btn:disabled {
            background-color: #ccc;
            color: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .interactive-activity {
            background-color: #e9f7fe;
            border-left: 4px solid var(--accent);
            padding: 20px;
            margin: 25px 0;
            border-radius: 0 6px 6px 0;
        }
        
        .activity-title {
            font-weight: 600;
            color: var(--secondary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .activity-title i {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        
        .drag-drop-container { 
            display: flex;
            flex-wrap: wrap;
            gap: 10px; 
            margin: 20px 0;
            padding: 10px;
            border: 1px solid var(--light);
            border-radius: 6px;
            min-height: 50px; 
        }
        
        .draggable { 
            background-color: white;
            border: 2px dashed var(--primary);
            padding: 8px 12px; 
            border-radius: 6px;
            cursor: grab;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: all 0.3s;
            text-align: center;
        }
        
        .draggable:hover {
            background-color: var(--light);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .dropzone { 
            border: 2px solid transparent; 
            border-radius: 8px;
            padding: 0; 
            background-color: transparent; 
            margin: 10px 0; 
            transition: all 0.3s;
        }
        
        .dropzone p { 
            display: flex;
            align-items: center;
            flex-wrap: wrap; 
            padding: 10px; 
            border: 1px solid #eee; 
            border-radius: 6px;
        }

        .drop-target { 
            min-width: 80px; 
            min-height: 38px; 
            display: inline-flex; 
            align-items: center;
            justify-content: center;
            vertical-align: middle; 
            border: 2px dashed var(--accent); 
            border-radius: 6px;
            padding: 2px; 
            margin: 0 5px; 
        }
        .drop-target:not(:empty) { 
            border-color: transparent; 
            padding: 0;
        }
        .drop-target .draggable {
            margin: 0; 
            box-shadow: none;
            border: 2px solid var(--secondary); 
            background-color: var(--light);
        }
        
        .dropzone.highlight .drop-target { 
            background-color: rgba(79, 195, 247, 0.2);
            border-color: var(--secondary);
        }
        
        .audio-player {
            width: 100%;
            margin: 15px 0;
        }
        
        .quiz-container {
            margin: 25px 0;
        }
        
        .quiz-question {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .preposition-select, .vocab-input {
            padding: 8px;
            border: 1px solid #ddd; 
            border-radius: 4px;
            margin-right: 5px;
            transition: border-color 0.3s, background-color 0.3s, box-shadow 0.3s; 
        }
        .preposition-select:focus, .vocab-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 0.2rem rgba(var(--rgb-primary), 0.25); 
        }

        .feedback-text { 
            margin-left: 8px;
            font-size: 0.9em;
        }
        .feedback-text-dd { 
             margin-left: 10px;
             font-weight: bold;
        }
        
        .btn {
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            gap: 8px; 
            padding: 10px 20px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 6px; 
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500; 
            text-decoration: none;
            transition: all 0.2s ease-in-out; 
            text-align: center;
            margin-top: 5px; 
            margin-right: 5px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); 
        }
        
        .btn:hover:not(:disabled) {
            background-color: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15); 
        }
        .btn:focus:not(:disabled) {
            outline: none; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.05), 0 0 0 3px rgba(var(--rgb-primary), 0.35); 
        }
        .btn:active:not(:disabled) {
            transform: translateY(0px); 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
        }
        
        .btn:disabled {
            background-color: #ccc;
            color: #666; 
            cursor: not-allowed;
            transform: none; 
            box-shadow: none; 
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white; 
        }
        
        .btn-secondary:hover:not(:disabled) {
            background-color: #5a6268;
        }
        .btn-secondary:focus:not(:disabled) {
            box-shadow: 0 2px 4px rgba(0,0,0,0.05), 0 0 0 3px rgba(var(--rgb-btn-secondary-focus), 0.45); 
        }
        
        .save-all-btn {
            background-color: var(--success);
            margin-top: 20px;
            padding: 12px 25px;
            font-size: 1.1rem;
        }
        
        .save-all-btn:hover:not(:disabled) {
            background-color: #218838;
        }
        .save-all-btn:focus:not(:disabled) {
            box-shadow: 0 2px 4px rgba(0,0,0,0.05), 0 0 0 3px rgba(var(--rgb-success), 0.45); 
        }
        
        .verse-box {
            background-color: #f8f9fa;
            border-left: 4px solid var(--primary);
            padding: 15px;
            margin: 20px 0;
            font-style: italic;
            position: relative;
        }
        
        .verse-ref {
            text-align: right;
            font-weight: 500;
            color: var(--secondary);
            margin-top: 10px;
        }
        
        .page { display: none; }
        .page.active { display: block; }

        .page-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px; 
            padding-top: 20px; 
            border-top: 1px solid #e0e0e0; 
        }
        /* Specific style for first page navigation to push Next button to the right */
        #page1 .page-navigation {
            justify-content: flex-end;
        }

        .page-indicator {
            text-align: center;
            margin-top: 15px; 
            color: #777;
            font-size: 0.9em;
        }
        
        @media (max-width: 992px) { 
            .image-gallery-container .image-upload-slot {
                max-width: 48%; 
            }
        }
        @media (max-width: 768px) {
            .container { padding: 15px; }
            header { padding: 15px 0; }
            h1 { font-size: 1.8rem; }
            .lesson-section { padding: 15px; }
            .edit-controls {
                top: 10px; 
                right: 10px;
            }
            .edit-controls button {
                padding: 5px 10px; 
                font-size: 0.8rem;
            }
            .edit-controls button i {
                font-size: 0.7rem;
            }
            .dropzone p {
                flex-direction: column; 
                align-items: flex-start;
            }
            .drop-target {
                margin: 5px 0; 
            }
            .image-gallery-container .image-upload-slot { 
                max-width: 100%; 
            }
            .btn { 
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            .save-all-btn {
                padding: 10px 20px;
                font-size: 1rem;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>LOTW Lesson #A1-17</h1>
            <p>Prepositions of Place & God's Laws</p>
        </header>
        
        <!-- Page 1: Introduction (MODIFIED Previous button removed) -->
        <div class="page active" id="page1">
            <section class="lesson-section">
                <div class="edit-controls">
                    <button class="edit-btn-section" onclick="enableEdit(this)"><i class="fas fa-edit"></i> Edit</button>
                    <button class="save-btn-section hidden" onclick="saveSectionChanges(this)"><i class="fas fa-save"></i> Save</button>
                    <button class="cancel-btn-section hidden" onclick="cancelSectionChanges(this)"><i class="fas fa-times"></i> Cancel</button>
                </div>
                <h2>Pray, Review, and Preview</h2>
                <div class="content-editable" id="p1-prayer-review" contenteditable="false">
                    <p>Let's begin our lesson with prayer. Dear Lord, thank you for this opportunity to learn English and your Word. Help us to understand your laws and how to use prepositions correctly. Amen.</p>
                </div>
                <div class="verse-box">
                    <div class="edit-controls">
                        <button class="edit-btn-section" onclick="enableEdit(this)"><i class="fas fa-edit"></i> Edit</button>
                        <button class="save-btn-section hidden" onclick="saveSectionChanges(this)"><i class="fas fa-save"></i> Save</button>
                        <button class="cancel-btn-section hidden" onclick="cancelSectionChanges(this)"><i class="fas fa-times"></i> Cancel</button>
                    </div>
                    <div class="content-editable" id="p1-versebox-1peter" contenteditable="false">
                        "Be holy in everything you do, just as God is holy. He is the one who chose you." - 1 Peter 1:15 ERV
                    </div>
                </div>
            </section>
            <section class="lesson-section">
                <div class="edit-controls">
                    <button class="edit-btn-section" onclick="enableEdit(this)"><i class="fas fa-edit"></i> Edit</button>
                    <button class="save-btn-section hidden" onclick="saveSectionChanges(this)"><i class="fas fa-save"></i> Save</button>
                    <button class="cancel-btn-section hidden" onclick="cancelSectionChanges(this)"><i class="fas fa-times"></i> Cancel</button>
                </div>
                <h2>Today's Learning Objectives</h2>
                <div class="content-editable" id="p1-learning-objectives" contenteditable="false">
                    <p>By the end of this lesson, you will be able to:</p>
                    <ul>
                        <li>Use prepositions of place correctly in sentences</li>
                        <li>Pronounce /L/ and /H/ sounds accurately</li>
                        <li>Understand the story of Moses receiving God's laws</li>
                        <li>Apply God's commandments to daily life</li>
                        <li>Ask and answer questions about locations</li>
                    </ul>
                </div>
            </section>
            <div class="page-navigation">
                <!-- Previous button removed as requested for the first page -->
                <button class="btn" onclick="navigateTo(2)">Next <i class="fas fa-arrow-right"></i></button>
            </div>
            <div class="page-indicator">Page 1 of 6</div>
        </div>
        
        <!-- Page 2: Bible Reading -->
        <div class="page" id="page2">
             <section class="lesson-section">
                <div class="edit-controls">
                    <button class="edit-btn-section" onclick="enableEdit(this)"><i class="fas fa-edit"></i> Edit</button>
                    <button class="save-btn-section hidden" onclick="saveSectionChanges(this)"><i class="fas fa-save"></i> Save</button>
                    <button class="cancel-btn-section hidden" onclick="cancelSectionChanges(this)"><i class="fas fa-times"></i> Cancel</button>
                </div>
                <h2>Bible Reading: Moses Gives God's Laws</h2>
                <div class="content-editable" id="p2-bible-reading-main" contenteditable="false">
                    <p>Today we'll read from Exodus 3:9-12; 5:1-11; 12:21-42; 20:1-17</p>
                    <p><strong>Theme:</strong> Where is it?</p>
                </div>
                <div class="image-container">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/3/3d/Rembrandt_-_Moses_with_the_Ten_Commandments_-_Google_Art_Project.jpg" alt="Moses with the Ten Commandments" id="bible-story-img">
                    <div>
                        <button class="upload-btn" onclick="document.getElementById('image-upload-page2').click()"><i class="fas fa-upload"></i> Change Image</button>
                        <input type="file" id="image-upload-page2" accept="image/*" style="display: none;" onchange="previewImage(event, 'bible-story-img')">
                    </div>
                </div>
            </section>
            <section class="lesson-section">
                <div class="edit-controls">
                    <button class="edit-btn-section" onclick="enableEdit(this)"><i class="fas fa-edit"></i> Edit</button>
                    <button class="save-btn-section hidden" onclick="saveSectionChanges(this)"><i class="fas fa-save"></i> Save</button>
                    <button class="cancel-btn-section hidden" onclick="cancelSectionChanges(this)"><i class="fas fa-times"></i> Cancel</button>
                </div>
                <h2>Bible Story Summary</h2>
                <div class="content-editable" id="p2-bible-story-summary" contenteditable="false">
                    <p>Four hundred thirty (430) years passed. God's people grew in number. The new king of Egypt made them his slaves and was not kind to them.</p>
                    <p>Then God sent Moses to bring his people out of Egypt. Moses did many miracles to set them free. Moses led the people to a mountain.</p>
                    <p>God loved the people he made. He wanted them to live good, holy lives. So he gave them some laws. These laws help people to live the way God wants.</p>
                </div>
            </section>
            <div class="page-navigation">
                <button class="btn btn-secondary" onclick="navigateTo(1)"><i class="fas fa-arrow-left"></i> Previous</button>
                <button class="btn" onclick="navigateTo(3)">Next <i class="fas fa-arrow-right"></i></button>
            </div>
            <div class="page-indicator">Page 2 of 6</div>
        </div>

        <!-- Page 3: Pronunciation and Grammar -->
        <div class="page" id="page3">
            <section class="lesson-section">
                <div class="edit-controls">
                    <button class="edit-btn-section" onclick="enableEdit(this)"><i class="fas fa-edit"></i> Edit</button>
                    <button class="save-btn-section hidden" onclick="saveSectionChanges(this)"><i class="fas fa-save"></i> Save</button>
                    <button class="cancel-btn-section hidden" onclick="cancelSectionChanges(this)"><i class="fas fa-times"></i> Cancel</button>
                </div>
                <h2>Pronunciation Practice: /L/ and /H/ Sounds</h2>
                <div class="content-editable" id="p3-pronunciation-practice" contenteditable="false">
                    <p>Let's practice these sounds that appear in our prepositions:</p>
                    <ul>
                        <li><strong>/L/ sound:</strong> love, law, Lord, lead, holy</li>
                        <li><strong>/H/ sound:</strong> help, have, hundred, house, home</li>
                    </ul>
                </div>
                <div class="interactive-activity">
                    <div class="activity-title"><i class="fas fa-volume-up"></i> Listen and Repeat</div>
                    <audio controls class="audio-player" id="pronunciation-audio">
                        <source src="audio/pronunciation.mp3" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>
                    <button class="upload-btn" onclick="document.getElementById('audio-upload-page3').click()"><i class="fas fa-upload"></i> Change Audio</button>
                    <input type="file" id="audio-upload-page3" accept="audio/*" style="display: none;" onchange="previewAudio(event, 'pronunciation-audio')">
                    <div class="content-editable" id="p3-listen-repeat-instructions" contenteditable="false"> 
                        <p>Repeat after the audio:</p>
                        <ol>
                            <li>The Lord loves and helps us.</li>
                            <li>He helps us have holy lives.</li>
                            <li>Moses led the people to the holy land.</li>
                        </ol>
                    </div>
                </div>
            </section>
            <section class="lesson-section">
                <div class="edit-controls">
                    <button class="edit-btn-section" onclick="enableEdit(this)"><i class="fas fa-edit"></i> Edit</button>
                    <button class="save-btn-section hidden" onclick="saveSectionChanges(this)"><i class="fas fa-save"></i> Save</button>
                    <button class="cancel-btn-section hidden" onclick="cancelSectionChanges(this)"><i class="fas fa-times"></i> Cancel</button>
                </div>
                <h2>Grammar: Prepositions of Place</h2>
                <div class="content-editable" id="p3-grammar-prepositions" contenteditable="false">
                    <p>Prepositions tell us <strong>where</strong> something is. Today we'll practice:</p>
                    <ul>
                        <li>in, on, at</li>
                        <li>above, below, under</li>
                        <li>beside, between, behind</li>
                        <li>around, across</li>
                    </ul>
                </div>
            </section>
            <div class="page-navigation">
                <button class="btn btn-secondary" onclick="navigateTo(2)"><i class="fas fa-arrow-left"></i> Previous</button>
                <button class="btn" onclick="navigateTo(4)">Next <i class="fas fa-arrow-right"></i></button>
            </div>
            <div class="page-indicator">Page 3 of 6</div>
        </div>
        
        <!-- Page 4: Interactive Practice -->
        <div class="page" id="page4">
            <section class="lesson-section">
                <div class="edit-controls">
                    <button class="edit-btn-section" onclick="enableEdit(this)"><i class="fas fa-edit"></i> Edit</button>
                    <button class="save-btn-section hidden" onclick="saveSectionChanges(this)"><i class="fas fa-save"></i> Save</button>
                    <button class="cancel-btn-section hidden" onclick="cancelSectionChanges(this)"><i class="fas fa-times"></i> Cancel</button>
                </div>
                <h2>Interactive Practice: Where Is It?</h2>
                <div class="interactive-activity">
                    <div class="activity-title"><i class="fas fa-eye"></i> What Do You See? (Choose from 3 images)</div>
                    
                    <div class="image-gallery-container">
                        <div class="image-upload-slot">
                            <img src="https://freebibleimages.org/slides/parables/parable-good-samaritan-03.jpg" alt="Preposition scene 1" id="preposition-practice-img-1">
                            <button class="upload-btn" onclick="document.getElementById('image-upload-page4-1').click()"><i class="fas fa-upload"></i> Change Image 1</button>
                            <input type="file" id="image-upload-page4-1" accept="image/*" style="display: none;">
                        </div>
                        <div class="image-upload-slot">
                            <img src="https://freebibleimages.org/slides/parables/parable-good-samaritan-03.jpg" alt="Preposition scene 2" id="preposition-practice-img-2">
                            <button class="upload-btn" onclick="document.getElementById('image-upload-page4-2').click()"><i class="fas fa-upload"></i> Change Image 2</button>
                            <input type="file" id="image-upload-page4-2" accept="image/*" style="display: none;">
                        </div>
                        <div class="image-upload-slot">
                            <img src="https://cdn.pixabay.com/photo/2014/07/22/09/59/bread-399286_1280.jpg" alt="Preposition scene 3" id="preposition-practice-img-3">
                            <button class="upload-btn" onclick="document.getElementById('image-upload-page4-3').click()"><i class="fas fa-upload"></i> Change Image 3</button>
                            <input type="file" id="image-upload-page4-3" accept="image/*" style="display: none;">
                        </div>
                    </div>
                    
                    <div class="quiz-container">
                        <div class="quiz-question">
                            <div class="content-editable" id="p4-quiz-instructions" contenteditable="false">
                                <p>Complete the sentences (you can refer to any of the images above):</p>
                            </div>
                            <ol>
                                <li>The people are 
                                    <select class="preposition-select" data-correct-answer="at">
                                        <option value="">Choose...</option>
                                        <option value="at">at</option>
                                        <option value="in">in</option>
                                        <option value="on">on</option>
                                    </select> the park. <span class="feedback-text"></span>
                                </li>
                                <li>The tree is 
                                    <select class="preposition-select" data-correct-answer="behind">
                                        <option value="">Choose...</option>
                                        <option value="behind">behind</option>
                                        <option value="in front of">in front of</option>
                                        <option value="beside">beside</option>
                                    </select> the woman. <span class="feedback-text"></span>
                                </li>
                                <li>The bread is 
                                    <select class="preposition-select" data-correct-answer="in">
                                        <option value="">Choose...</option>
                                        <option value="in">in</option>
                                        <option value="on">on</option>
                                        <option value="under">under</option>
                                    </select> the basket. <span class="feedback-text"></span>
                                </li>
                            </ol>
                            <button class="btn" onclick="checkPrepositions()"><i class="fas fa-check"></i> Check Answers</button>
                        </div>
                    </div>
                </div>
            </section>
            
            <div class="page-navigation">
                <button class="btn btn-secondary" onclick="navigateTo(3)"><i class="fas fa-arrow-left"></i> Previous</button>
                <button class="btn" onclick="navigateTo(5)">Next <i class="fas fa-arrow-right"></i></button>
            </div>
            <div class="page-indicator">Page 4 of 6</div>
        </div>
        
        <!-- Page 5: Drag and Drop Activity -->
        <div class="page" id="page5">
            <section class="lesson-section">
                <div class="edit-controls">
                    <button class="edit-btn-section" onclick="enableEdit(this)"><i class="fas fa-edit"></i> Edit</button>
                    <button class="save-btn-section hidden" onclick="saveSectionChanges(this)"><i class="fas fa-save"></i> Save</button>
                    <button class="cancel-btn-section hidden" onclick="cancelSectionChanges(this)"><i class="fas fa-times"></i> Cancel</button>
                </div>
                <h2>Drag and Drop Prepositions</h2>
                 <div class="content-editable" id="p5-drag-drop-instructions" contenteditable="false">
                    <p>Drag the prepositions to complete the sentences:</p>
                </div>
                <div class="interactive-activity">
                    <div class="activity-title"><i class="fas fa-arrows-alt"></i> Drag the Prepositions</div>
                    <div class="drag-drop-container" id="drag-drop-pool">
                        <div class="draggable" draggable="true" data-word="on">on</div>
                        <div class="draggable" draggable="true" data-word="behind">behind</div>
                        <div class="draggable" draggable="true" data-word="above">above</div>
                        <div class="draggable" draggable="true" data-word="at">at</div>
                        <div class="draggable" draggable="true" data-word="beside">beside</div>
                        <div class="draggable" draggable="true" data-word="in">in</div>
                    </div>
                    <div class="dropzone" id="dropzone-1" data-correct="on">
                        <p>1. The food is <span class="drop-target"></span> the blanket.</p>
                    </div>
                    <div class="dropzone" id="dropzone-2" data-correct="behind">
                        <p>2. The tree is <span class="drop-target"></span> the woman.</p>
                    </div>
                    <div class="dropzone" id="dropzone-3" data-correct="above">
                        <p>3. The sun is <span class="drop-target"></span> the land.</p>
                    </div>
                     <div class="dropzone" id="dropzone-4" data-correct="at">
                        <p>4. The people are <span class="drop-target"></span> the park.</p>
                    </div>
                    <div class="dropzone" id="dropzone-5" data-correct="beside">
                        <p>5. The dog is <span class="drop-target"></span> the man.</p>
                    </div>
                    <div class="dropzone" id="dropzone-6" data-correct="in">
                        <p>6. The bread is <span class="drop-target"></span> the basket.</p>
                    </div>
                    <button class="btn" onclick="checkDragDrop()"><i class="fas fa-check-double"></i> Check All</button>
                    <button class="btn btn-secondary" onclick="resetDragDrop()"><i class="fas fa-undo"></i> Reset</button>
                </div>
            </section>
            <div class="page-navigation">
                <button class="btn btn-secondary" onclick="navigateTo(4)"><i class="fas fa-arrow-left"></i> Previous</button>
                <button class="btn" onclick="navigateTo(6)">Next <i class="fas fa-arrow-right"></i></button>
            </div>
            <div class="page-indicator">Page 5 of 6</div>
        </div>
        
        <!-- Page 6: Vocabulary and Conclusion -->
        <div class="page" id="page6">
            <section class="lesson-section">
                <div class="edit-controls">
                    <button class="edit-btn-section" onclick="enableEdit(this)"><i class="fas fa-edit"></i> Edit</button>
                    <button class="save-btn-section hidden" onclick="saveSectionChanges(this)"><i class="fas fa-save"></i> Save</button>
                    <button class="cancel-btn-section hidden" onclick="cancelSectionChanges(this)"><i class="fas fa-times"></i> Cancel</button>
                </div>
                <h2>Vocabulary Review</h2>
                <div class="content-editable" id="p6-vocab-review-instructions" contenteditable="false">
                    <p>Listen and write these words:</p>
                </div>
                <div class="interactive-activity">
                    <div class="activity-title"><i class="fas fa-headphones"></i> Listen and Write</div>
                    <audio controls class="audio-player" id="vocabulary-audio">
                        <source src="audio/vocabulary.mp3" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>
                    <button class="upload-btn" onclick="document.getElementById('audio-upload-page6').click()"><i class="fas fa-upload"></i> Change Audio</button>
                    <input type="file" id="audio-upload-page6" accept="audio/*" style="display: none;" onchange="previewAudio(event, 'vocabulary-audio')">
                    <div class="quiz-container">
                        <div class="quiz-question">
                            <div class="content-editable" id="p6-listen-write-instructions" contenteditable="false">
                                <p>Write one word per line as you hear them:</p>
                            </div>
                            <div id="vocab-words" style="column-count: 2; column-gap: 30px;">
                                <div style="break-inside: avoid;">
                                    <input type="text" class="vocab-input" style="width: 100%; margin-bottom: 10px; padding: 8px;"><span class="feedback-text"></span><br>
                                    <input type="text" class="vocab-input" style="width: 100%; margin-bottom: 10px; padding: 8px;"><span class="feedback-text"></span><br>
                                    <input type="text" class="vocab-input" style="width: 100%; margin-bottom: 10px; padding: 8px;"><span class="feedback-text"></span><br>
                                    <input type="text" class="vocab-input" style="width: 100%; margin-bottom: 10px; padding: 8px;"><span class="feedback-text"></span><br>
                                    <input type="text" class="vocab-input" style="width: 100%; margin-bottom: 10px; padding: 8px;"><span class="feedback-text"></span><br>
                                    <input type="text" class="vocab-input" style="width: 100%; margin-bottom: 10px; padding: 8px;"><span class="feedback-text"></span><br>
                                </div>
                                <div style="break-inside: avoid;">
                                    <input type="text" class="vocab-input" style="width: 100%; margin-bottom: 10px; padding: 8px;"><span class="feedback-text"></span><br>
                                    <input type="text" class="vocab-input" style="width: 100%; margin-bottom: 10px; padding: 8px;"><span class="feedback-text"></span><br>
                                    <input type="text" class="vocab-input" style="width: 100%; margin-bottom: 10px; padding: 8px;"><span class="feedback-text"></span><br>
                                    <input type="text" class="vocab-input" style="width: 100%; margin-bottom: 10px; padding: 8px;"><span class="feedback-text"></span><br>
                                    <input type="text" class="vocab-input" style="width: 100%; margin-bottom: 10px; padding: 8px;"><span class="feedback-text"></span><br>
                                    <input type="text" class="vocab-input" style="width: 100%; margin-bottom: 10px; padding: 8px;"><span class="feedback-text"></span><br>
                                </div>
                            </div>
                            <button class="btn" onclick="showVocabAnswers()"><i class="fas fa-eye"></i> Show Answers</button>
                             <button class="btn btn-secondary" onclick="resetVocab()"><i class="fas fa-undo"></i> Reset</button>
                        </div>
                    </div>
                </div>
            </section>
            <section class="lesson-section">
                <div class="edit-controls">
                    <button class="edit-btn-section" onclick="enableEdit(this)"><i class="fas fa-edit"></i> Edit</button>
                    <button class="save-btn-section hidden" onclick="saveSectionChanges(this)"><i class="fas fa-save"></i> Save</button>
                    <button class="cancel-btn-section hidden" onclick="cancelSectionChanges(this)"><i class="fas fa-times"></i> Cancel</button>
                </div>
                <h2>Lesson Summary</h2>
                <div class="content-editable" id="p6-lesson-summary" contenteditable="false">
                    <p>Today we learned:</p>
                    <ul>
                        <li>How to use prepositions of place correctly</li>
                        <li>The story of Moses receiving God's laws</li>
                        <li>How God wants us to live holy lives</li>
                        <li>Important vocabulary about locations</li>
                    </ul>
                </div>
                <div class="verse-box">
                    <div class="edit-controls">
                        <button class="edit-btn-section" onclick="enableEdit(this)"><i class="fas fa-edit"></i> Edit</button>
                        <button class="save-btn-section hidden" onclick="saveSectionChanges(this)"><i class="fas fa-save"></i> Save</button>
                        <button class="cancel-btn-section hidden" onclick="cancelSectionChanges(this)"><i class="fas fa-times"></i> Cancel</button>
                    </div>
                    <div class="content-editable" id="p6-versebox-psalm" contenteditable="false">
                        "His love for his followers is as high above us as heaven is above the earth." - Psalm 103:11 ERV
                    </div>
                </div>
            </section>
            <div class="text-center" style="margin-bottom: 20px;"> 
                <button class="btn save-all-btn" onclick="saveAllChanges()"><i class="fas fa-save"></i> Save All Changes</button>
            </div>
            <div class="page-navigation">
                <button class="btn btn-secondary" onclick="navigateTo(5)"><i class="fas fa-arrow-left"></i> Previous</button>
                <!-- Next button removed as requested for the last page -->
            </div>
            <div class="page-indicator">Page 6 of 6</div>
        </div>
        
        <footer>
            <p>©2020-2021 Literacy International - Light of the World Program</p>
        </footer>
    </div>

    <script>
        // Navigation between pages
        let currentPage = 1;
        const totalPages = 6;
        function navigateTo(pageNumber) {
            if (pageNumber < 1 || pageNumber > totalPages) return;
            const currentPageElement = document.getElementById(`page${currentPage}`);
            const nextPageElement = document.getElementById(`page${pageNumber}`);
            if (currentPageElement) currentPageElement.classList.remove('active');
            if (nextPageElement) nextPageElement.classList.add('active');
            currentPage = pageNumber;
            document.querySelectorAll('.page-indicator').forEach(indicator => {
                indicator.textContent = `Page ${currentPage} of ${totalPages}`;
            });
            window.scrollTo(0, 0);
        }

        // --- EDITING FUNCTIONS ---
        function enableEdit(triggerElement) {
            let controlsContainer, section, editableToActivate, editBtnAssociated;
            if (triggerElement.classList.contains('edit-btn-section')) { 
                editBtnAssociated = triggerElement;
                controlsContainer = editBtnAssociated.parentElement;
                section = controlsContainer.closest('.lesson-section, .verse-box');
                if (!section) { console.error("Edit button's control container is not within a .lesson-section or .verse-box.", controlsContainer); return; }
                editableToActivate = section.querySelector('.content-editable'); 
            } else if (triggerElement.classList.contains('content-editable')) { 
                editableToActivate = triggerElement;
                section = editableToActivate.closest('.lesson-section, .verse-box');
                if (!section) { return; }
                controlsContainer = section.querySelector('.edit-controls');
                if (controlsContainer) {
                    editBtnAssociated = controlsContainer.querySelector('.edit-btn-section');
                } else { return; }
            } else { console.error("enableEdit called with an unknown element type:", triggerElement); return; }
            if (!editableToActivate) {
                if (editBtnAssociated && controlsContainer) { 
                    editBtnAssociated.innerHTML = '<i class="fas fa-eye-slash"></i> No Edit Area';
                    editBtnAssociated.disabled = true;
                    const saveBtn = controlsContainer.querySelector('.save-btn-section');
                    const cancelBtn = controlsContainer.querySelector('.cancel-btn-section');
                    if(saveBtn) { saveBtn.classList.add('hidden'); saveBtn.disabled = true; }
                    if(cancelBtn) { cancelBtn.classList.add('hidden'); cancelBtn.disabled = true; }
                }
                console.warn("No .content-editable element could be targeted for editing in section:", section ? section.id : "Unknown section", "Trigger:", triggerElement);
                return;
            }
            if (section) {
                const previouslyEditing = section.querySelector('.content-editable[data-currently-editing="true"]');
                if (previouslyEditing && previouslyEditing !== editableToActivate) {
                    const prevOriginalContent = previouslyEditing.getAttribute('data-original-content');
                    if (prevOriginalContent !== null) { previouslyEditing.innerHTML = prevOriginalContent; }
                    previouslyEditing.setAttribute('contenteditable', 'false');
                    previouslyEditing.removeAttribute('data-original-content');
                    previouslyEditing.removeAttribute('data-currently-editing');
                }
            }
            editableToActivate.setAttribute('data-original-content', editableToActivate.innerHTML);
            editableToActivate.setAttribute('contenteditable', 'true');
            editableToActivate.setAttribute('data-currently-editing', 'true'); 
            editableToActivate.focus();
            if (controlsContainer) {
                const saveBtn = controlsContainer.querySelector('.save-btn-section');
                const cancelBtn = controlsContainer.querySelector('.cancel-btn-section');
                if (editBtnAssociated) editBtnAssociated.classList.add('hidden'); 
                if (saveBtn) saveBtn.classList.remove('hidden');
                if (cancelBtn) cancelBtn.classList.remove('hidden');
            }
        }
        function saveSectionChanges(saveBtn) {
            const controlsContainer = saveBtn.parentElement;
            const section = controlsContainer.closest('.lesson-section, .verse-box');
            if (!section) { console.error("Save button not in a valid section's controls.", saveBtn); return; }
            const editable = section.querySelector('.content-editable[data-currently-editing="true"]');
            if (!editable) {
                console.warn("Save clicked, but no 'data-currently-editing' element found in section:", section.id);
                const editBtn = controlsContainer.querySelector('.edit-btn-section');
                const cancelBtn = controlsContainer.querySelector('.cancel-btn-section');
                saveBtn.classList.add('hidden');
                if (cancelBtn) cancelBtn.classList.add('hidden');
                if (editBtn) editBtn.classList.remove('hidden');
                return;
            }
            editable.setAttribute('contenteditable', 'false');
            editable.removeAttribute('data-original-content'); 
            editable.removeAttribute('data-currently-editing'); 
            console.log(`Section content for '${editable.id || 'unknown_editable_id'}' saved.`);
            const editBtn = controlsContainer.querySelector('.edit-btn-section');
            const cancelBtn = controlsContainer.querySelector('.cancel-btn-section');
            saveBtn.classList.add('hidden');
            if (cancelBtn) cancelBtn.classList.add('hidden');
            if (editBtn) editBtn.classList.remove('hidden');
        }
        function cancelSectionChanges(cancelBtn) {
            const controlsContainer = cancelBtn.parentElement;
            const section = controlsContainer.closest('.lesson-section, .verse-box');
            if (!section) { console.error("Cancel button not in a valid section's controls.", cancelBtn); return; }
            const editable = section.querySelector('.content-editable[data-currently-editing="true"]');
            if (!editable) {
                console.warn("Cancel clicked, but no 'data-currently-editing' element found in section:", section.id);
                const editBtn = controlsContainer.querySelector('.edit-btn-section');
                const saveBtn = controlsContainer.querySelector('.save-btn-section');
                cancelBtn.classList.add('hidden');
                if (saveBtn) saveBtn.classList.add('hidden');
                if (editBtn) editBtn.classList.remove('hidden');
                return;
            }
            const originalContent = editable.getAttribute('data-original-content');
            if (originalContent !== null) { editable.innerHTML = originalContent; }
            editable.setAttribute('contenteditable', 'false');
            editable.removeAttribute('data-original-content');
            editable.removeAttribute('data-currently-editing'); 
            const editBtn = controlsContainer.querySelector('.edit-btn-section');
            const saveBtn = controlsContainer.querySelector('.save-btn-section');
            cancelBtn.classList.add('hidden');
            if (saveBtn) saveBtn.classList.add('hidden');
            if (editBtn) editBtn.classList.remove('hidden');
        }
        
        // --- IMAGE AND AUDIO PREVIEW ---
        function previewImage(event, imgId) {
            const reader = new FileReader();
            const output = document.getElementById(imgId);
            if (!output) {
                console.error("Image element not found:", imgId);
                return;
            }
            reader.onload = function(){
                output.src = reader.result;
            };
            if (event.target.files && event.target.files[0]) {
                reader.readAsDataURL(event.target.files[0]);
            }
        }
        function previewAudio(event, audioId) {
            const reader = new FileReader();
            const audioPlayer = document.getElementById(audioId);
             if (!audioPlayer) {
                console.error("Audio player element not found:", audioId);
                return;
            }
            reader.onload = function(e) {
                audioPlayer.src = e.target.result;
                audioPlayer.load();
            };
            if (event.target.files && event.target.files[0]) {
                reader.readAsDataURL(event.target.files[0]);
            }
        }
        
        // --- DRAG AND DROP FUNCTIONALITY ---
        let draggedItem = null; 
        const originalDraggablePoolId = 'drag-drop-pool';
        
        function addDraggableEvents(draggable) {
            draggable.addEventListener('dragstart', handleDragStart);
            draggable.addEventListener('dragend', handleDragEnd);
        }

        function handleDragStart(event) {
            draggedItem = event.target; 
            setTimeout(() => { 
                if (draggedItem && draggedItem.parentElement && draggedItem.parentElement.id === originalDraggablePoolId) {
                    draggedItem.style.opacity = '0.5'; 
                }
            }, 0);
            if (draggedItem.parentElement && draggedItem.parentElement.classList.contains('drop-target')) {
                draggedItem.style.border = '2px dashed var(--primary)'; 
                draggedItem.style.backgroundColor = 'white';
            }
        }

        function handleDragEnd() {
            if (draggedItem) {
                draggedItem.style.opacity = '1'; 
            }
            draggedItem = null;
            document.querySelectorAll('.drag-drop-container.highlight, .drop-target.highlight').forEach(el => {
                el.classList.remove('highlight');
            });
        }

        function handleDragOver(event) {
            event.preventDefault(); 
            if (event.target.classList.contains('drop-target') || (event.target.id === originalDraggablePoolId)) {
                const targetElement = event.target.classList.contains('drop-target') ? event.target : 
                                      (event.target.closest('.drop-target') || (event.target.id === originalDraggablePoolId ? event.target : null));
                if (targetElement) {
                    targetElement.classList.add('highlight');
                }
            } else if (event.target.closest('.drop-target')) { 
                 event.target.closest('.drop-target').classList.add('highlight');
            }
        }

        function handleDragLeave(event) {
            if (event.target.classList.contains('drop-target') || (event.target.id === originalDraggablePoolId)) {
                event.target.classList.remove('highlight');
            } else if (event.target.closest('.drop-target')) {
                event.target.closest('.drop-target').classList.remove('highlight');
            }
        }
        function handleDragLeavePool(event) { 
            if (event.target.id === originalDraggablePoolId) {
                event.target.classList.remove('highlight');
            }
        }

        function handleDropOnTarget(event) {
            event.preventDefault();
            const currentDropTargetSpan = event.target.closest('.drop-target'); 
            if (!currentDropTargetSpan || !draggedItem) {
                if(draggedItem) draggedItem.style.opacity = '1'; 
                return;
            }

            currentDropTargetSpan.classList.remove('highlight');
            const parentDropzoneDiv = currentDropTargetSpan.closest('.dropzone');
            const dragDropPool = document.getElementById(originalDraggablePoolId);

            const existingPrepositionDiv = currentDropTargetSpan.querySelector('.draggable');
            if (existingPrepositionDiv && existingPrepositionDiv !== draggedItem) {
                existingPrepositionDiv.style.border = '2px dashed var(--primary)'; 
                existingPrepositionDiv.style.backgroundColor = 'white';       
                dragDropPool.appendChild(existingPrepositionDiv);
            }
            currentDropTargetSpan.innerHTML = ''; 
            currentDropTargetSpan.appendChild(draggedItem);
            draggedItem.style.opacity = '1'; 
            draggedItem.style.border = '2px solid var(--secondary)'; 
            draggedItem.style.backgroundColor = 'var(--light)';

            const userAnswer = draggedItem.dataset.word;
            const correctAnswer = parentDropzoneDiv.dataset.correct;

            if (userAnswer === correctAnswer) {
                draggedItem.style.borderColor = 'var(--success)';
                draggedItem.style.backgroundColor = 'rgba(40, 167, 69, 0.15)'; 
            } else {
                draggedItem.style.borderColor = 'var(--danger)';
                draggedItem.style.backgroundColor = 'rgba(220, 53, 69, 0.15)'; 
            }
            currentDropTargetSpan.setAttribute('data-answer', userAnswer); 
        }

        function handleDropOnPool(event) {
            event.preventDefault();
            const pool = document.getElementById(originalDraggablePoolId);
            if (!draggedItem || !pool) return;
            pool.classList.remove('highlight');
            
            if (draggedItem.parentElement && draggedItem.parentElement.classList.contains('drop-target')) {
                draggedItem.style.border = '2px dashed var(--primary)'; 
                draggedItem.style.backgroundColor = 'white';       
                draggedItem.style.opacity = '1';
                pool.appendChild(draggedItem);
            } else if (draggedItem.parentElement && draggedItem.parentElement.id !== originalDraggablePoolId) {
                draggedItem.style.border = '2px dashed var(--primary)'; 
                draggedItem.style.backgroundColor = 'white';       
                draggedItem.style.opacity = '1';
                pool.appendChild(draggedItem);
            }
        }
        
        function checkDragDrop() {
            const dropzones = document.querySelectorAll('#page5 .dropzone');
            let allAreCorrect = true;
            let anyMissing = false;
            
            dropzones.forEach(zone => {
                const targetSpan = zone.querySelector('.drop-target');
                if (!targetSpan) return;

                targetSpan.style.borderStyle = 'dashed'; 
                targetSpan.style.borderColor = targetSpan.querySelector('.draggable') ? 'transparent' : 'var(--accent)'; 

                const placedDraggableDiv = targetSpan.querySelector('.draggable');
                const correctAnswer = zone.dataset.correct;
                
                if (placedDraggableDiv) {
                    const userAnswer = placedDraggableDiv.dataset.word;
                    if (userAnswer !== correctAnswer) {
                        allAreCorrect = false;
                         placedDraggableDiv.style.borderColor = 'var(--danger)'; 
                         placedDraggableDiv.style.backgroundColor = 'rgba(220, 53, 69, 0.15)';
                    } else {
                         placedDraggableDiv.style.borderColor = 'var(--success)'; 
                         placedDraggableDiv.style.backgroundColor = 'rgba(40, 167, 69, 0.15)';
                    }
                } else {
                    allAreCorrect = false;
                    anyMissing = true;
                    targetSpan.style.borderColor = 'var(--danger)'; 
                }
            });
            
            if (allAreCorrect) {
                alert('Great job! All prepositions are placed correctly!');
            } else if (anyMissing) {
                alert('Some prepositions are missing or incorrect. Please review the highlighted slots.');
            } else { 
                alert('Some prepositions are incorrect. Please review the highlighted items.');
            }
        }
        
        function resetDragDrop() {
            const dragDropPool = document.getElementById(originalDraggablePoolId);
            const dropTargets = document.querySelectorAll('#page5 .drop-target'); 

            dropTargets.forEach(targetSpan => {
                const placedDraggableDiv = targetSpan.querySelector('.draggable');
                if (placedDraggableDiv) {
                    placedDraggableDiv.style.border = '2px dashed var(--primary)';
                    placedDraggableDiv.style.backgroundColor = 'white';
                    placedDraggableDiv.style.opacity = '1';
                    dragDropPool.appendChild(placedDraggableDiv);
                }
                targetSpan.innerHTML = ''; 
                targetSpan.removeAttribute('data-answer'); 
                targetSpan.style.borderColor = 'var(--accent)'; 
                targetSpan.style.borderStyle = 'dashed';
            });

            dragDropPool.querySelectorAll('.draggable').forEach(d => {
                d.style.border = '2px dashed var(--primary)';
                d.style.backgroundColor = 'white';
                d.style.opacity = '1';
            });
        }
        
        // --- PREPOSITION SELECT QUIZ (PAGE 4) (MODIFIED) ---
        function checkIndividualPreposition(selectElement) {
            const correctAnswer = selectElement.dataset.correctAnswer;
            const feedbackSpan = selectElement.parentElement.querySelector('.feedback-text');

            if (!feedbackSpan) {
                console.warn("Feedback span not found for select:", selectElement);
                return null; 
            }

            feedbackSpan.textContent = ''; 
            selectElement.style.backgroundColor = ''; 
            selectElement.style.borderColor = '#ddd'; 

            if (selectElement.value === "") {
                feedbackSpan.textContent = ' Please choose.';
                feedbackSpan.style.color = 'var(--warning)';
                selectElement.style.borderColor = 'var(--warning)';
                return null; 
            }

            if (selectElement.value === correctAnswer) {
                selectElement.style.backgroundColor = 'rgba(40, 167, 69, 0.1)';
                selectElement.style.borderColor = 'var(--success)';
                feedbackSpan.textContent = ' Correct!';
                feedbackSpan.style.color = 'var(--success)';
                return true; 
            } else {
                selectElement.style.backgroundColor = 'rgba(220, 53, 69, 0.1)';
                selectElement.style.borderColor = 'var(--danger)';
                feedbackSpan.textContent = ` Incorrect. (Correct: ${correctAnswer})`;
                feedbackSpan.style.color = 'var(--danger)';
                return false; 
            }
        }

        function checkPrepositions() {
            const selects = document.querySelectorAll('#page4 .preposition-select');
            let allAnsweredAndCorrect = true;
            let hasIncorrect = false;
            let hasUnanswered = false;

            selects.forEach(select => {
                const result = checkIndividualPreposition(select); 
                if (result === null) { 
                    hasUnanswered = true;
                    allAnsweredAndCorrect = false;
                } else if (result === false) { 
                    hasIncorrect = true;
                    allAnsweredAndCorrect = false;
                }
            });

            if (allAnsweredAndCorrect) {
                alert('Excellent! All your preposition answers are correct!');
            } else {
                let message = "Please review your answers.";
                if (hasIncorrect && hasUnanswered) {
                    message = "Some answers are incorrect and some questions are unanswered.";
                } else if (hasIncorrect) {
                    message = "Some answers are incorrect.";
                } else if (hasUnanswered) {
                    message = "Some questions are unanswered.";
                }
                alert(message + " Check the feedback next to each question.");
            }
        }
        
        // --- VOCABULARY REVIEW (PAGE 6) ---
        function showVocabAnswers() {
            const correctWords = [
                'laws', 'between', 'under', 
                'around', 'below', 'across', 
                'above', 'land', 'help', 
                'have', 'Lord', 'love'
            ]; 
            const inputs = document.querySelectorAll('.vocab-input');
            let allCorrectUserAnswers = true; 
            let allWordsAttempted = true;  
            inputs.forEach((input, index) => {
                const feedbackSpan = input.nextElementSibling; 
                if (!feedbackSpan || !feedbackSpan.classList.contains('feedback-text')) {
                    console.warn("Feedback span not found for vocab input", input); return;
                }
                feedbackSpan.textContent = ''; 
                input.style.backgroundColor = ''; 
                input.style.borderColor = '#ddd'; 
                if (index < correctWords.length) {
                    const userAnswer = input.value.trim().toLowerCase(); 
                    const correctAnswer = correctWords[index].toLowerCase(); 
                    if (!userAnswer) { 
                        allWordsAttempted = false; 
                        input.style.backgroundColor = 'rgba(255, 193, 7, 0.1)'; 
                        input.style.borderColor = 'var(--warning)';
                        feedbackSpan.textContent = ` Missing. (Answer: ${correctWords[index]})`;
                        feedbackSpan.style.color = 'var(--warning)';
                        allCorrectUserAnswers = false; 
                    } else if (userAnswer === correctAnswer) {
                        input.style.backgroundColor = 'rgba(40, 167, 69, 0.1)'; 
                        input.style.borderColor = 'var(--success)';
                        feedbackSpan.textContent = ' Correct!';
                        feedbackSpan.style.color = 'var(--success)';
                    } else {
                        input.style.backgroundColor = 'rgba(220, 53, 69, 0.1)'; 
                        input.style.borderColor = 'var(--danger)';
                        feedbackSpan.textContent = ` Incorrect. (Answer: ${correctWords[index]})`;
                        feedbackSpan.style.color = 'var(--danger)';
                        allCorrectUserAnswers = false; 
                    }
                } else { input.disabled = true; }
            });
            if(allCorrectUserAnswers && allWordsAttempted) {
                alert("Great job! All vocabulary words are correct!");
            } else { 
                alert("Some vocabulary words are incorrect or missing. The correct answers are now shown or indicated.");
            }
        }
        function resetVocab() {
            const inputs = document.querySelectorAll('.vocab-input');
            inputs.forEach(input => {
                input.value = ''; 
                input.style.backgroundColor = ''; 
                input.style.borderColor = '#ddd'; 
                input.disabled = false; 
                const feedbackSpan = input.nextElementSibling;
                if (feedbackSpan && feedbackSpan.classList.contains('feedback-text')) {
                    feedbackSpan.textContent = ''; 
                }
            });
        }

        // --- SAVE ALL CHANGES (General Content) ---
        function saveAllChanges() {
            const allEditableContent = {};
            let activeEditsExist = false;
            document.querySelectorAll('.content-editable').forEach(el => {
                 if (el.id) { allEditableContent[el.id] = el.innerHTML;
                 } else { console.warn("Editable element found without an ID. Skipping save for this element:", el); }
                 if (el.getAttribute('contenteditable') === 'true' || el.dataset.currentlyEditing === 'true') { activeEditsExist = true; }
            });
            if (activeEditsExist) {
                 alert("Warning: Some sections appear to be in edit mode. 'Save All' logs current content to console but doesn't finalize individual section edits. Please save or cancel individual sections first for proper state management.");
            }
            console.log("Saving ALL content (innerHTML of .content-editable elements with IDs):", allEditableContent);
            alert(`All content from ${Object.keys(allEditableContent).length} identified editable regions has been logged to the console. Implement actual save logic as needed.`);
        }

        // --- DOMContentLoaded INITIALIZATIONS ---
        document.addEventListener('DOMContentLoaded', function() {
            // Click-to-edit for content-editable divs
            document.querySelectorAll('.content-editable').forEach(editableDiv => {
                editableDiv.addEventListener('click', function(event) {
                    if (this.getAttribute('contenteditable') === 'true') return;
                    enableEdit(this); 
                });
            });

            // Drag and Drop Setup (Page 5)
            const draggables = document.querySelectorAll('#page5 .draggable');
            const dropTargets = document.querySelectorAll('#page5 .drop-target');
            const dragDropPool = document.getElementById(originalDraggablePoolId);
            
            draggables.forEach(draggable => {
                addDraggableEvents(draggable);
            });
            
            dropTargets.forEach(target => {
                target.addEventListener('dragover', handleDragOver);
                target.addEventListener('dragleave', handleDragLeave);
                target.addEventListener('drop', handleDropOnTarget);
            });

            if (dragDropPool) {
                dragDropPool.addEventListener('dragover', handleDragOver);
                dragDropPool.addEventListener('dragleave', handleDragLeavePool);
                dragDropPool.addEventListener('drop', handleDropOnPool);
            }
            
            // Image and Audio upload initializers
            const generalImageUploads = [
                { inputId: 'image-upload-page2', imgId: 'bible-story-img' }
            ];
            generalImageUploads.forEach(upload => {
                const inputElement = document.getElementById(upload.inputId);
                if (inputElement && !inputElement.onchange) { 
                    inputElement.onchange = (event) => previewImage(event, upload.imgId);
                }
            });

            const page4ImageInputs = [
                { inputId: 'image-upload-page4-1', imgId: 'preposition-practice-img-1' },
                { inputId: 'image-upload-page4-2', imgId: 'preposition-practice-img-2' },
                { inputId: 'image-upload-page4-3', imgId: 'preposition-practice-img-3' }
            ];
            page4ImageInputs.forEach(upload => {
                const inputElement = document.getElementById(upload.inputId);
                if (inputElement) {
                    inputElement.onchange = (event) => previewImage(event, upload.imgId);
                }
            });

            const audioUploads = [
                { inputId: 'audio-upload-page3', audioId: 'pronunciation-audio' },
                { inputId: 'audio-upload-page6', audioId: 'vocabulary-audio' }
            ];
            audioUploads.forEach(upload => {
                const inputElement = document.getElementById(upload.inputId);
                if (inputElement && !inputElement.onchange) {
                    inputElement.onchange = (event) => previewAudio(event, upload.audioId);
                }
            });

            // Setup for Page 4 Preposition Selects (Immediate Feedback)
            const prepositionSelects = document.querySelectorAll('#page4 .preposition-select');
            prepositionSelects.forEach(select => {
                select.addEventListener('change', function() {
                    checkIndividualPreposition(this); 
                });
            });
        });
    </script>
</body>
</html>
